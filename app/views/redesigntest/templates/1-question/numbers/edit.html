{% extends "layouts/main.html" %}
{% from "components/service-header/macro.njk" import serviceHeader %}
{% set pageName = "Edit long answer question - Apply for a county parish holding number in England" %}
{% set headingPlaceholder = "Page heading" %}
{% set guidancePlaceholder = "" %}

{% block header %}
{{ serviceHeader({
organisationName: "Defra",
productName: "Forms Designer",
serviceName: "",
containerClasses: containerClasses,
accountName: "Chris Smith",
homepageLink: "/",
signOutLink: "/onboarding/sign-out-confirmation",
navigationItems: [
{ href: "/library.html", text: "Forms library", id: "nav-library" },
{ href: "/cph-overview/draft/complete-clean.html", text: "Overview", id: "nav-overview" },
{ href: "/redesigntest/listing", text: "Editor", id: "nav-editor" } ],
activeLinkId: "nav-editor"
}) }}

<div class="x-govuk-masthead x-govuk-masthead--large">
  <div class="govuk-width-container">
    {{ govukBackLink({ classes: "govuk-back-link--inverse govuk-!-margin-bottom-0", text: "Back to add
    and edit pages", href: "/redesigntest/listing.html" }) }}

    <hr class="govuk-section-break govuk-section-break--m govuk-section-break--visible"
      style="border-bottom: 1px solid white; margin-bottom: 0" />

    <div class="govuk-grid-row">
      <div class="govuk-grid-column-full-from-desktop">
        <h1 class="x-govuk-masthead__title">
          {# <span class="govuk-caption-l" style="color: white">
            Apply for a county parish holding certificate
          </span> #}
          Food order form (user research)
        </h1>


      </div>
    </div>
  </div>
</div>
{% endblock %}

{% block content %}
<div class="govuk-grid-row">
  <div class="govuk-grid-column-full">
    <div class="govuk-grid-row">
      <!-- Left Column for Form Controls -->
      <div class="govuk-grid-column-one-half-from-desktop" id="container" style="flex: 1 1 75%; overflow-y: auto">
        <div class="govuk-summary-card govuk-!-margin-top-0" style="border-left: 10px solid #008938">
          <div class="govuk-summary-card__content govuk-!-padding-top-0" style="background-color: #f3f2f1">
            <dl class="govuk-summary-list">
              <div class="govuk-summary-list__row">
                <dd class="govuk-summary-list__value">
                  <!-- Dynamic Summary List -->
                  <!-- Question Settings Container -->
                  <div class="govuk-grid-row" id="page-settings-container-1">
                    <div id="question-1">
                      <div class="govuk-summary-card__content" style="margin-bottom: 0">
                        <!-- Sub Navigation for Question -->
                        <nav class="moj-sub-navigation govuk-!-padding-top-0 govuk-!-margin-bottom-2 "
                          aria-label="Sub navigation">
                          <ul class="moj-sub-navigation__list" id="nav-list2">
                            <!-- Question Link -->
                            {# <li class="moj-sub-navigation__item">
                              <a class="moj-sub-navigation__link" href="#question-1">Page settings</a>
                            </li> #}
                            {# <li class="moj-sub-navigation__item">
                              <a class="moj-sub-navigation__link" href="#overview-noquestions">Overview of questions</a>
                            </li> #}
                            <li class="moj-sub-navigation__item">
                              <a class="moj-sub-navigation__link" aria-current="page" id="edit-page"
                                href="#edit-page">Page 10</a>
                            </li>
                          </ul>
                        </nav>

                        <div class="govuk-summary-card__title-wrapper govuk-!-padding-top-0"></div>

                        {# <span class="govuk-caption-l">Page 1</span> #}
                        <h2 class="govuk-heading-l">Edit page 10</h2>

                        <form method="post" id="options-form"
                          action="/redesigntest/templates/1-question/numbers/overview">
                          {% from "govuk/components/input/macro.njk" import govukInput %}

                          <!-- Question Label Input -->
                          <div class="govuk-form-group">
                            <label class="govuk-label govuk-label--m" for="question-label-input-numbers">
                              Question
                            </label>
                            <input class="govuk-input" id="question-label-input-numbers"
                              name="questionLabelInputNumbers" type="text" value="">
                          </div>


                          <!-- Hint Text Input -->
                          {{ govukTextarea({
                          label: {
                          text: "Hint text (optional)",
                          classes: "govuk-label--m"
                          },
                          id: "hint-text-input-numbers",
                          name: "hintTextInputNumbers",
                          value: data['hint-text-input-numbers'],
                          classes: "govuk-textarea",
                          rows: 3,
                          describedBy: "hint-text-input-numbers"
                          }) }}

                          <!-- Make Optional Checkbox -->
                          <div class="govuk-form-group">
                            <div class="govuk-checkboxes--small">
                              <div class="govuk-checkboxes__item">
                                <input class="govuk-checkboxes__input" id="make-optional" name="makeOptional"
                                  type="checkbox" value="optional">
                                <label class="govuk-label govuk-checkboxes__label" for="make-optional">
                                  Make this question optional
                                </label>
                              </div>
                            </div>
                          </div>


                          <!-- Add guidance above this question -->
                          <details class="govuk-details" data-module="govuk-details">
                            <summary class="govuk-details__summary">
                              <span class="govuk-details__summary-text">
                                Add guidance above this question (optional)
                              </span>
                            </summary>
                            <div class="govuk-details__text">
                              <!-- Default Content for Question 1 -->
                              <div id="question-1-content" class="question-content" style="margin-top: 10px;">

                                <!-- Page Heading Input -->
                                {{ govukInput({
                                label: {
                                text: "Page heading",
                                classes: "govuk-label govuk-label--m govuk-!-margin-top-0"
                                },
                                hint: {
                                text: "Page headings should be a statement and not a question. For example, ‘Passport
                                information’",
                                id: "page-heading-input-hint"
                                },
                                id: "page-heading-input-numbers",
                                name: "pageHeadingNumbers",
                                type: "text",
                                attributes: {
                                'aria-describedby': "page-heading-input-hint",
                                'data-preview-target': '#dynamic-heading'
                                }
                                }) }}

                                <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>

                                <!-- Guidance Text Numbers -->
                                {{ govukTextarea({
                                label: {
                                text: "Guidance text (optional)",
                                classes: "govuk-label govuk-label--m"
                                },
                                hint: {
                                text: "Use Markdown to format the content or add hyperlinks",
                                id: "guidance-Numbers-hint"
                                },
                                id: "guidance-numbers",
                                name: "guidanceNumbers",
                                rows: 5,
                                attributes: {
                                'aria-describedby': "guidance-numbers-hint",
                                'data-preview-target': '#guidance-paragraph'
                                }
                                }) }}

                              </div>

                              <details class="govuk-details">
                                <summary class="govuk-details__summary">
                                  <span class="govuk-details__summary-text">
                                    Help with markdown
                                  </span>
                                </summary>
                                <div class="govuk-details__text">
                                  <h3 class="govuk-heading-s">Headings and subheadings</h3>
                                  <p class="govuk-body">Use one hash symbol followed by a space for a heading, for
                                    example:</p>
                                  <pre class="formatting-example"
                                    style="background-color: white;"><code class="lang-md"># This is a heading</code></pre>
                                  <p class="bottom-gutter-1-3">To add a subheading, use 2 hash symbols:</p>
                                  <pre class="formatting-example"
                                    style="background-color: white;"><code class="lang-md">## This is a subheading</code></pre>

                                  <h3 class="govuk-heading-s" id="bullets">Bullet points</h3>
                                  <p class="govuk-body">Use bullet points to help words or phrases stand out in your
                                    emails and letters.</p>
                                  <p class="govuk-body">Copy this example to add bullet points:</p>
                                  <pre class="formatting-example" style="background-color: white;"><code class="lang-md">Introduce bullet points with a lead-in line ending in a colon:

* leave one empty line space after the lead-in line
* use an asterisk or a dash followed by a space to add an item
* start each item with a lowercase letter, do not end with a full stop
* leave one empty line space after the last item</code></pre>

                                  <h3 class="govuk-heading-s" id="bullets">Numbered steps</h3>
                                  <p class="govuk-body">Copy this example to add numbered steps:</p>
                                  <pre class="formatting-example" style="background-color: white;"><code class="lang-md">1. Leave one empty line space before starting your list.
2. Enter a number followed by a full stop and a space to add an item.
3. Start each item with a capital letter and end it with a full stop.
4. Leave one empty line space after the last item.</code></pre>

                                  <h3 class="govuk-heading-s">Links and URLs</h3>
                                  <p class="govuk-body">To convert text into a link, use square brackets around the link
                                    text and round brackets around the full URL. Make sure there are no spaces between
                                    the brackets or the link will not work. For example:</p>
                                  <pre class="formatting-example"
                                    style="background-color: white;"><code class="lang-md">[Apply now](https://www.gov.uk/example)</code></pre>

                                </div>
                              </details>
                            </div>
                          </details>

                          {{ govukInput({
                          label: {
                          text: "Short description",
                          classes: "govuk-label--m",
                          isPageHeading: false
                          },
                          hint: {
                          text: "Enter a short description for this question like 'licence period'. Short descriptions
                          are used in error messages and on the check your answers page."
                          },
                          id: "error-message-input-shorttext",
                          name: "errorMessageInputShorttext"
                          }) }}

                          <!-- Answer limits -->
                          <details class="govuk-details" data-module="govuk-details">
                            <summary class="govuk-details__summary">
                              <span class="govuk-details__summary-text">
                                Set answer limits (optional)
                              </span>
                            </summary>
                            <div class="govuk-details__text">
                              <!-- Default Content for Question 1 -->
                              <div id="question-1-content" class="question-content" style="margin-top: 10px;">

                                <!-- Page Heading Input -->
                                {% from "govuk/components/input/macro.njk" import govukInput %}

                                {{ govukInput({
                                label: {
                                text: "Lowest number users can enter (optional)",
                                classes: "govuk-label--m",
                                isPageHeading: false
                                },
                                classes: "govuk-input--width-3",

                                id: "min-number",
                                name: "minNumber",
                                inputmode: "numeric",
                                spellcheck: false
                                }) }}

                                {{ govukInput({
                                label: {
                                text: "Highest number users can enter (optional)",
                                classes: "govuk-label--m",
                                isPageHeading: false
                                },
                                classes: "govuk-input--width-3",
                                id: "max-number",
                                name: "minNumber",
                                inputmode: "numeric",
                                spellcheck: false
                                }) }}

                                {{ govukInput({
                                label: {
                                text: "Precision (optional)",
                                classes: "govuk-label--m",
                                isPageHeading: false
                                },
                                hint: {
                                text: "Specifies the number of decimal places users can enter. For example, to allow
                                users to enter numbers with up to two decimal places, set this to 2"
                                },
                                classes: "govuk-input--width-3",
                                id: "precision-number",
                                name: "precisionNumber",
                                inputmode: "numeric",
                                spellcheck: false
                                }) }}

                                {{ govukInput({
                                label: {
                                text: "Prefix (optional)",
                                classes: "govuk-label--m",
                                isPageHeading: false
                                },
                                hint: {
                                text: "For example, a symbol or abbreviation for the type of information you’re asking
                                for, like, '£'"
                                },
                                classes: "govuk-input--width-5",
                                id: "prefix-number",
                                name: "prefixNumber",
                                spellcheck: false
                                }) }}

                                {{ govukInput({
                                label: {
                                text: "Suffix (optional)",
                                classes: "govuk-label--m",
                                isPageHeading: false
                                },
                                hint: {
                                text: "For example, a symbol or abbreviation for the type of information you’re asking
                                for, like,'per item' or 'Kg'"
                                },
                                classes: "govuk-input--width-5",
                                id: "suffix-number",
                                name: "suffixNumber",
                                spellcheck: false
                                }) }}

                                {{ govukInput({
                                label: {
                                text: "Classes (optional)",
                                classes: "govuk-label--m",
                                isPageHeading: false
                                },
                                hint: {
                                text: "Apply CSS classes to this question. For example, ‘govuk-input govuk-!-width-full’
                                "
                                },
                                classes: "govuk-input--width-6",
                                id: "classes-number",
                                name: "classesNumber",
                                spellcheck: false
                                }) }}

                              </div>
                          </details>

                          <a href="#tab-two" class="govuk-skip-link" style="margin-bottom: 30px!important;"
                            data-module="govuk-skip-link">
                            Skip to error messages preview
                          </a>

                          <!-- Section Break -->
                          <hr class="govuk-section-break govuk-section-break--m govuk-section-break--visible">

                          <!-- Question Settings Summary List -->
                          <h2 class="govuk-heading-m">Question settings</h2>

                          {{ govukSummaryList({
                          "rows": [
                          {
                          "key": {
                          "text": "Type of information"
                          },
                          "value": {
                          "html": "Numbers only"
                          },
                          "actions": {
                          "items": [
                          {
                          "href": "/redesigntest/templates/1-question/information-type.html",
                          "text": "Change",
                          "visuallyHiddenText": " type"
                          }
                          ]
                          }
                          }
                          ]
                          }) }}



                          <hr class="govuk-section-break govuk-section-break--m govuk-section-break--visible">


                          <!-- Other form elements... -->

                          <!-- Submit Button -->
                          <div class="moj-button-action">
                            {{ govukButton({
                            text: 'Save and continue',
                            type: 'submit'
                            }) }}
                          </div>

                          <a href="#tab-one" class="govuk-skip-link" style="margin-bottom: 30px!important;"
                            data-module="govuk-skip-link">
                            Skip to page preview
                          </a>
                        </form>
                      </div>
                    </div>
                  </div>
                </dd>
              </div>
            </dl>
          </div>
        </div>
      </div>

      <!-- Right Column for Preview -->
      <div class="govuk-grid-column-one-half-from-desktop" id="second-container"
        style="outline: solid 1px #008938; height: 100%; position: sticky; top: 0; padding: 20px; box-shadow: 5px 10px #008938;">
        <!-- Before content -->
        <div id="before-content" style=" background-color:  #cce2d8;">
          <p class="govuk-body-s" style="margin-bottom: 0; color: #005a30; padding: 2px 8px 3px;
text-align: center;"> Previews
          </p>
        </div>

        <div style="margin-top: 60px;">
          {% from "govuk/components/tabs/macro.njk" import govukTabs %}

          <div class="govuk-tabs" data-module="govuk-tabs">
            <h2 class="govuk-tabs__title">
              Contents
            </h2>
            <ul class="govuk-tabs__list">
              <li class="govuk-tabs__list-item govuk-tabs__list-item--selected">
                <a class="govuk-tabs__tab" href="#tab-one">Page preview</a>
              </li>
              <li class="govuk-tabs__list-item">
                <a class="govuk-tabs__tab" href="#tab-two">Error messages</a>
              </li>
            </ul>

            <div class="govuk-tabs__panel" id="tab-one">
              <!-- Page Preview Content -->


              <p class="govuk-body-s" style="margin-bottom: 30px; border-bottom: #008938 1px;">
                <a href="#" class="govuk-link govuk-link--no-visited-state" rel="noreferrer noopener" target="_blank">
                  Preview this page in a new tab
                </a>
              </p>

              {% include "/redesigntest/templates/previews/numbers/edit.html" %}

              <a href="#edit-page" class="govuk-skip-link" style="margin-bottom: 30px!important;"
                data-module="govuk-skip-link">
                Skip to edit page
              </a>
            </div>


            <div class="govuk-tabs__panel" id="tab-two">
              <p class="govuk-body-s" style="margin-bottom: 30px; border-bottom: #008938 1px;">
                <a href="#" class="govuk-link govuk-link--no-visited-state" rel="noreferrer noopener" target="_blank">
                  Preview error messages in a new tab
                </a>
              </p>
              <!-- Error Messages Content -->
              <div class="govuk-error-summary" data-disable-auto-focus="true">
                <h2 class="govuk-error-summary__title">There is a problem</h2>
                <ul class="govuk-list govuk-error-summary__list">
                  <!-- List of errors -->
                  <li><a id="empty-input-error-shorttext" class="govuk-error-message">Enter <span
                        id="error-dynamic-text">[short description]</span></a></li>
                  <li><a id="empty-input-error-shorttext" class="govuk-error-message"><span
                        id="error-dynamic-text">[Short description]</span> must be a whole number</a></li>
                  <h3 class="govuk-heading-s">If you set answer limits:</h3>
                  <li><a id="too-long-input-error-shorttext" class="govuk-error-message"><span
                        id="error-dynamic-text-long">[Short description]</span> must be <span id="max-length">[lowest
                        number]</span> or more</a></li>
                  <li><a id="too-short-input-error-shorttext" class="govuk-error-message"><span
                        id="error-dynamic-text-short">[Short description]</span> must be <span id="min-length">[highest
                        number]</span> or fewer</a></li>
                </ul>
              </div>
              <a href="#error-message-input-shorttext" class="govuk-skip-link" style="margin-bottom: 30px!important;"
                data-module="govuk-skip-link">
                Skip to edit short description
              </a>

            </div>
          </div>
        </div>

      </div>

      <!-- JavaScript code -->
      <script>
        document.addEventListener('DOMContentLoaded', function () {
          // DOM Elements
          const domElements = {
            // Existing elements
            questionLabelInputNumbers: document.getElementById('question-label-input-numbers'),
            questionLabelLegendNumbers: document.getElementById('question-label-legend-numbers'),
            hintTextInputNumbers: document.getElementById('hint-text-input-numbers'),
            hintTextOutputNumbers: document.getElementById('hint-text-output-numbers'),
            makeOptionalCheckbox: document.getElementById('make-optional'),

            // New elements for page heading and guidance text
            pageHeadingInputNumbers: document.getElementById('page-heading-input-numbers'),
            dynamicHeading: document.getElementById('dynamic-heading'),
            guidanceNumbers: document.getElementById('guidance-numbers'),
            guidanceParagraph: document.getElementById('guidance-paragraph')
          };

          // Initialize event listeners
          initializeEventListeners();

          function initializeEventListeners() {
            // Update question label
            if (domElements.questionLabelInputNumbers && domElements.questionLabelLegendNumbers) {
              domElements.questionLabelInputNumbers.addEventListener('input', updateQuestionLabel);
            }

            // Update hint text and handle placeholder
            if (domElements.hintTextInputNumbers && domElements.hintTextOutputNumbers) {
              domElements.hintTextInputNumbers.addEventListener('input', updateHintText);
              domElements.hintTextInputNumbers.addEventListener('focus', showPlaceholderHint);
              domElements.hintTextInputNumbers.addEventListener('blur', clearPlaceholderHint);
            }

            // Update page heading and handle placeholder
            if (domElements.pageHeadingInputNumbers && domElements.dynamicHeading) {
              domElements.pageHeadingInputNumbers.addEventListener('input', updatePageHeading);
              domElements.pageHeadingInputNumbers.addEventListener('focus', showPlaceholderHeading);
              domElements.pageHeadingInputNumbers.addEventListener('blur', clearPlaceholderHeading);
            }

            // Update guidance text and handle placeholder
            if (domElements.guidanceNumbers && domElements.guidanceParagraph) {
              domElements.guidanceNumbers.addEventListener('input', updateGuidanceText);
              domElements.guidanceNumbers.addEventListener('focus', showPlaceholderGuidance);
              domElements.guidanceNumbers.addEventListener('blur', clearPlaceholderGuidance);
            }

            // Apply focus/blur highlighting
            applyHighlightOnFocus(domElements.questionLabelInputNumbers, domElements.questionLabelLegendNumbers);
            applyHighlightOnFocus(domElements.hintTextInputNumbers, domElements.hintTextOutputNumbers);
            applyHighlightOnFocus(domElements.pageHeadingInputNumbers, domElements.dynamicHeading);
            applyHighlightOnFocus(domElements.guidanceNumbers, domElements.guidanceParagraph);
          }

          function updateQuestionLabel() {
            const suffix = domElements.makeOptionalCheckbox.checked ? ' (optional)' : '';
            domElements.questionLabelLegendNumbers.textContent = domElements.questionLabelInputNumbers.value || 'Question';
            domElements.questionLabelLegendNumbers.textContent += suffix;
          }

          function updateHintText() {
            domElements.hintTextOutputNumbers.textContent = domElements.hintTextInputNumbers.value;
          }

          function updatePageHeading() {
            domElements.dynamicHeading.textContent = domElements.pageHeadingInputNumbers.value;
          }

          function updateGuidanceText() {
            domElements.guidanceParagraph.textContent = domElements.guidanceNumbers.value;
          }

          function applyHighlightOnFocus(inputElement, targetElement) {
            if (inputElement && targetElement) {
              inputElement.addEventListener('focus', function () {
                targetElement.classList.add('highlight');
              });
              inputElement.addEventListener('blur', function () {
                targetElement.classList.remove('highlight');
              });

              // If the input is already focused
              if (document.activeElement === inputElement) {
                targetElement.classList.add('highlight');
              }
            }
          }

          // Placeholder handling for hint text
          function showPlaceholderHint() {
            if (!domElements.hintTextInputNumbers.value) {
              domElements.hintTextOutputNumbers.textContent = 'Hint text';
            }
          }

          function clearPlaceholderHint() {
            if (!domElements.hintTextInputNumbers.value) {
              domElements.hintTextOutput.textContent = '';
            }
          }

          // Placeholder handling for page heading
          function showPlaceholderHeading() {
            if (!domElements.pageHeadingInputNumbers.value) {
              domElements.dynamicHeading.textContent = 'Page heading';
            }
          }

          function clearPlaceholderHeading() {
            if (!domElements.pageHeadingInputNumbers.value) {
              domElements.dynamicHeading.textContent = '';
            }
          }

          // Placeholder handling for guidance text
          function showPlaceholderGuidance() {
            if (!domElements.guidanceNumbers.value) {
              domElements.guidanceParagraph.textContent = 'Guidance text';
            }
          }

          function clearPlaceholderGuidance() {
            if (!domElements.guidanceNumbers.value) {
              domElements.guidanceParagraph.textContent = '';
            }
          }
        });
      </script>
      <script>
        document.addEventListener("DOMContentLoaded", function () {
          const prefixInput = document.getElementById("prefix-number");
          const suffixInput = document.getElementById("suffix-number");

          const formGroupContainer = document.querySelector(".govuk-form-group h1 .govuk-label--l#question-label-legend-numbers")?.closest(".govuk-form-group");
          const targetInput = document.getElementById("numbers");

          if (formGroupContainer && targetInput) {
            let inputWrapper = formGroupContainer.querySelector(".govuk-input__wrapper");
            if (!inputWrapper) {
              inputWrapper = document.createElement("div");
              inputWrapper.className = "govuk-input__wrapper";

              const prefixDiv = document.createElement("div");
              prefixDiv.className = "govuk-input__prefix";
              prefixDiv.setAttribute("aria-hidden", "true");
              prefixDiv.style.display = "none"; // Hide by default

              const suffixDiv = document.createElement("div");
              suffixDiv.className = "govuk-input__suffix";
              suffixDiv.setAttribute("aria-hidden", "true");
              suffixDiv.style.display = "none"; // Hide by default

              inputWrapper.appendChild(prefixDiv);
              inputWrapper.appendChild(targetInput);
              inputWrapper.appendChild(suffixDiv);

              formGroupContainer.appendChild(inputWrapper);
            }

            const prefixDiv = formGroupContainer.querySelector(".govuk-input__prefix");
            const suffixDiv = formGroupContainer.querySelector(".govuk-input__suffix");

            // Function to show prefix/suffix on focus and update with input
            function handleFocus(element, displayElement, placeholderText) {
              displayElement.style.display = "inline-block"; // Show when focused
              displayElement.textContent = element.value || placeholderText; // Set value or placeholder
              displayElement.classList.add("highlight");
            }

            function handleBlur(element, displayElement) {
              if (!element.value) {
                displayElement.style.display = "none"; // Hide if empty on blur
              }
              displayElement.classList.remove("highlight");
            }

            // Event listeners for prefix
            prefixInput.addEventListener("focus", function () {
              handleFocus(prefixInput, prefixDiv, "Prefix");
            });
            prefixInput.addEventListener("blur", function () {
              handleBlur(prefixInput, prefixDiv);
            });
            prefixInput.addEventListener("input", function () {
              prefixDiv.textContent = prefixInput.value || "Prefix";
            });

            // Event listeners for suffix
            suffixInput.addEventListener("focus", function () {
              handleFocus(suffixInput, suffixDiv, "Suffix");
            });
            suffixInput.addEventListener("blur", function () {
              handleBlur(suffixInput, suffixDiv);
            });
            suffixInput.addEventListener("input", function () {
              suffixDiv.textContent = suffixInput.value || "Suffix";
            });
          }
        });
      </script>




      <script>
        document.addEventListener('DOMContentLoaded', function () {
          // DOM Elements
          const domElements = {
            questionLabelInputShorttext: document.getElementById('question-label-input-shorttext'),
            errorMessageInputShorttext: document.getElementById('error-message-input-shorttext'),
            errorMessagePreviewElements: document.querySelectorAll("#error-dynamic-text, #error-dynamic-text-long, #error-dynamic-text-short, #error-dynamic-text-range"),
            makeOptionalCheckbox: document.getElementById('make-optional'),
            minCharactersInput: document.getElementById('min-characters'),
            maxCharactersInput: document.getElementById('max-characters'),
            minCharactersPreview: document.querySelectorAll("#min-characters, #min-length, #min-length-range"),
            maxCharactersPreview: document.querySelectorAll("#max-characters, #max-length, #max-length-range")
          };

          // Initialize event listeners
          initializeEventListeners();

          function initializeEventListeners() {
            // Update short description and apply highlighting
            if (domElements.errorMessageInputShorttext && domElements.errorMessagePreviewElements.length) {
              domElements.errorMessageInputShorttext.addEventListener('input', updateErrorMessages);
              applyHighlightOnFocus(domElements.errorMessageInputShorttext, domElements.errorMessagePreviewElements);
            }

            // Apply focus/blur highlighting to other elements
            applyHighlightOnFocus(domElements.questionLabelInputShorttext, document.getElementById('question-label-legend'));

            // Update character limits dynamically
            if (domElements.minCharactersInput && domElements.maxCharactersInput) {
              domElements.minCharactersInput.addEventListener('input', updateCharacterLimits);
              domElements.maxCharactersInput.addEventListener('input', updateCharacterLimits);
            }
          }

          function updateErrorMessages() {
            const shortDescription = domElements.errorMessageInputShorttext.value || '[Short description]';
            domElements.errorMessagePreviewElements.forEach(element => {
              element.textContent = shortDescription;
            });
          }

          function updateCharacterLimits() {
            const minCharacters = domElements.minCharactersInput.value || '[min length]';
            const maxCharacters = domElements.maxCharactersInput.value || '[max length]';

            domElements.minCharactersPreview.forEach(element => {
              element.textContent = minCharacters;
            });

            domElements.maxCharactersPreview.forEach(element => {
              element.textContent = maxCharacters;
            });
          }

          function applyHighlightOnFocus(inputElement, targetElements) {
            if (inputElement && targetElements) {
              inputElement.addEventListener('focus', function () {
                targetElements.forEach(target => target.classList.add('highlight'));
              });
              inputElement.addEventListener('blur', function () {
                targetElements.forEach(target => target.classList.remove('highlight'));
              });

              // If the input is already focused, apply the highlight immediately
              if (document.activeElement === inputElement) {
                targetElements.forEach(target => target.classList.add('highlight'));
              }
            }
          }
        });
      </script>




      <script>
        document.addEventListener('DOMContentLoaded', function () {
          const errorMessageInputShorttext = document.getElementById('error-message-input-shorttext');
          const errorMessagePreviewSummary = document.getElementById('error-message-preview-summary');

          if (errorMessageInputShorttext && errorMessagePreviewSummary) {
            // Open details when input is focused
            errorMessageInputShorttext.addEventListener('focus', function () {
              errorMessagePreviewSummary.setAttribute('open', 'open');
            });

            // Close details when input loses focus
            errorMessageInputShorttext.addEventListener('blur', function () {
              errorMessagePreviewSummary.removeAttribute('open');
            });
          }
        });

      </script>


      <script>
        document.addEventListener('DOMContentLoaded', function () {
          // Get the textarea and the output paragraph elements
          const textarea = document.getElementById('guidance-numbers');
          const paragraph = document.getElementById('guidance-paragraph');

          // Listen for input events on the textarea
          textarea.addEventListener('input', function () {
            // Convert the textarea content using the marked library
            paragraph.innerHTML = marked.parse(textarea.value);
          });
        });
      </script>

      <!-- CSS for Highlighting -->
      <style>
        .highlight {
          background-color: #ffe5cc;
          border-bottom: 2px solid #ffb266;
        }

        #before-content {
          position: absolute;
          top: 0;
          left: 10 !important;
          right: 0;
          width: 100%;
          padding: 10px !important;
          box-sizing: border-box;
          z-index: 1;
          border-bottom: 1px solid #008938;
          padding-left: 10px;
        }

        #second-container {
          padding: 0;
          box-sizing: border-box;
        }

        #second-container>* {
          padding-left: 0px;
          z-index: 2;
        }
      </style>
    </div>
  </div>
  {% endblock %}