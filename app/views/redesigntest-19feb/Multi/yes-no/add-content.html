{% extends "layouts/main.html" %}
{% from "components/service-header/macro.njk" import serviceHeader %}
{% set pageName = "Edit page 1 - Apply for a county parish holding number in England" %}
{% set headingPlaceholder = "Page heading" %}
{% set guidancePlaceholder = "" %}
{#  #}
{% block header %}
  {{ serviceHeader({
    organisationName: "Defra",
    productName: "Forms Designer",
    serviceName: "",
    containerClasses: containerClasses,
    accountName: "Chris Smith",
    homepageLink: "/",
    signOutLink: "/onboarding/sign-out-confirmation",
    navigationItems: [
      { href: "/library.html", text: "Forms library", id: "nav-library" },
      { href: "/cph-overview/draft/complete-clean.html", text: "Overview", id: "nav-overview" },
      { href: "/redesigntest/listing", text: "Editor", id: "nav-editor" }    ],
    activeLinkId: "nav-editor"
  }) }}

<div class="x-govuk-masthead x-govuk-masthead--large">
  <div class="govuk-width-container">
    {{ govukBackLink({ classes: "govuk-back-link--inverse", text: "Back to add
    and edit pages", href: "/september/listing/2.html" }) }}

    <hr
      class="govuk-section-break govuk-section-break--m govuk-section-break--visible"
      style="border-bottom: 1px solid white; margin-bottom: 0"
    />

    <div class="govuk-grid-row">
      <div class="govuk-grid-column-two-thirds-from-desktop">
        <h1 class="x-govuk-masthead__title">
          <span class="govuk-caption-l" style="color: white"
            >Apply for a county parish holding certificate</span
          >

          Edit page 2
        </h1>

        <p class="govuk-body" style="color: white">Last saved at <time>5:24pm</time></p>

      </div>
    </div>
  </div>
</div>

{% endblock %} {% block content %}
<div class="govuk-grid-row">
  <div class="govuk-grid-column-full">
    <div class="govuk-grid-row">
      <!-- Left Column for Form Controls -->
      <div
        class="govuk-grid-column-one-half-from-desktop"
        id="container"
        style="flex: 1 1 75%; overflow-y: auto"
      >
        <div class="govuk-summary-card govuk-!-margin-top-0" style="border-left: 10px solid #008938">
          <div
            class="govuk-summary-card__content govuk-!-padding-top-0"
            style="background-color: #f3f2f1"
          >

            <dl class="govuk-summary-list">
              <div class="govuk-summary-list__row">
                <dd class="govuk-summary-list__value">
                  <!-- Dynamic Summary List -->

                  <!-- Question Settings Container -->
                  <div class="govuk-grid-row" id="page-settings-container-1">
                    <div id="question-1">
                      <div
                        class="govuk-summary-card__content"
                        style="margin-bottom: 0"
                      >
                        <!-- Sub Navigation for Question -->
                        <nav
                          class="moj-sub-navigation govuk-!-padding-top-0 govuk-!-margin-bottom-2 "
                          aria-label="Sub navigation"
                        >
                          <ul class="moj-sub-navigation__list" id="nav-list2">
                            <!-- Question Link -->
                            <li class="moj-sub-navigation__item">
                              <a
                                class="moj-sub-navigation__link"
                                href="#question-1"
                                >Page settings</a
                              >
                            </li>

                            <li class="moj-sub-navigation__item">
                              <a
                                class="moj-sub-navigation__link"
                                href="#overview-noquestions"
                                >Overview of questions</a
                              >
                            </li>

                            <li class="moj-sub-navigation__item">
                              <a
                                class="moj-sub-navigation__link"
                                aria-current="page"
                                href="#question-1-information-type"
                                >Question 1</a
                              >
                            </li>

                          </ul>
                        </nav>

                        <div
                          class="govuk-summary-card__title-wrapper govuk-!-padding-top-0"
                        ></div>


                        <span class="govuk-caption-l">Page 1</span>
                        <h2 class="govuk-heading-l">Question 1</h2>


                        {% from "govuk/components/input/macro.njk" import govukInput %}

{{ govukInput({
  label: {
    text: "Question",
    classes: "govuk-label--m",
    isPageHeading: false
  },
  id: "question-label-input-q1",
  value: data['question-label-input-q1'],
  name: "questionLabelInputq1"
}) }}


{{ govukTextarea({
  label: {
    text: "Hint text (optional)",
    classes: "govuk-label--m"

  },
  id: "hint-text-inputq1",
  name: "hintTextInputq1",
  value: data['hint-text-input'],
  classes: "govuk-textarea",
  rows: 3,
  describedBy: "hint-text-input-q1"
}) }}

<h2 class="govuk-heading-m">Add and edit the list of options</h2>

{% from "govuk/components/button/macro.njk" import govukButton %}

{{ govukButton({
  text: "Edit options",
  id: "edit-options",
  classes: "govuk-button--inverse"
}) }}




<!-- Make optional -->

{{ govukCheckboxes({
  name: "makeOptional",
  classes: "govuk-checkboxes--small",
  fieldset: {
    legend: {
      text: "Manage how the question is displayed",
      isPageHeading: true,
      classes: "govuk-fieldset__legend--m"
    }

  },
  items: [
    {
      value: data["optional-label-q1"],
      text: "Make this question optional"
    }
  ]
}) }}

{{ govukInput({
  label: {
    text: "Short description",
    classes: "govuk-label--m",
    isPageHeading: false
  },
  hint: {
    text: "Enter a short description for this question like 'licence period'. Short descriptions are used in error messages and on the check your answers page."
  },
  id: "error-message-input",
  value: data['error-message-input'],
  name: "errorMessageInput"
}) }}


<div id="summary-container">

  <hr class="govuk-section-break govuk-section-break--m govuk-section-break--visible">

  <!-- The dynamic summary list will be populated here -->
  <h2 class="govuk-heading-m">Question settings</h2>

  {{ govukSummaryList({
    classes: "govuk-summary-list govuk-section-break govuk-section-break--visible govuk-!-margin-bottom-6  ",
    rows: [
      {
        key: {
          text: "Type of information"
        },
        value: {
          html: data['short-answer']
        },
        actions: {
          items: [
            {
              href: "#",
              text: "Change",
              visuallyHiddenText: "name"
            }
          ]
        }
      }
    ]
  }) }}
</div>



      {{ govukButton({
        text: "Continue",
        id: "submit-list-button"
      }) }}

</div></div></div></div></div></div></div>

      <!-- Right Column for Additional Content -->
      <div
        class="govuk-grid-column-one-half-from-desktop"
        id="second-container"
        style="
          outline: solid 1px #008938;
          height: 100%;
          position: sticky;
          top: 0;
          padding: 20px;
          box-shadow: 5px 10px #008938;
        "
      >
        <!-- New HTML content for before element -->
        <div id="before-content">
          <p class="govuk-body-s" style="margin-bottom: 0">
            <a
              href="#"
              class="govuk-link govuk-link--no-visited-state"
              rel="noreferrer noopener"
              target="_blank"
              >Preview this page in a new tab</a
            >
          </p>
        </div>

        <!-- Additional Content Here -->
        <div class="additional-content">

          <div>
            <!-- Tag for Preview -->
            {{ govukTag({ text: "Preview of page 2", classes: "govuk-tag--yellow
            govuk-!-margin-bottom-2 govuk-!-margin-top-8" }) }}
            <!-- Form for Preview -->
            <form>
                 <!-- Dynamic Heading -->



                <div id="heading-container">
                  <span id="dynamic-caption" class="govuk-caption-l"></span>
                  <h1 class="govuk-heading-l" id="dynamic-heading"></h1>
                </div>

              <!-- Guidance Paragraph -->
              <p class="govuk-body" id="guidance-paragraph"></p>

              {% from "govuk/components/radios/macro.njk" import govukRadios %}


              <!-- Dynamic Heading -->


              <div id="heading-container">
                <span id="dynamic-caption" class="govuk-caption-l">{{ (data['setName'] or '') + ' 1' }}</span>




                <h1 class="govuk-heading-l" id="dynamic-heading">{{ data['pageHeading'] or '' }}</h1>

              </div>

          <!-- Guidance Paragraph -->
<p class="govuk-body" id="guidance-paragraph">{{ data['guidanceText'] or '' }}</p>

              <div id="radio-list">
                {{ govukRadios({
                  name: "listPreview",
                  fieldset: {
                    legend: {
                      value: data['list-preview-legend'],
                      name: "listPreviewLegend",

                      text: "",
                      isPageHeading: false,
                      classes: "govuk-fieldset__legend--m"
                    }
                  },
                  items: []
                }) }}
              </div>
            </form>


            {{ govukButton({ text: "Continue", classes: "govuk-button
            govuk-!-margin-top-3", id: "once-button", disabled: true }) }} {{
            govukButton({ text: "Add another [question set name]", classes:
            "govuk-button govuk-!-margin-top-3", id: "add-another-set-button",
            disabled: true, attributes: { style: "display:none;" } }) }}
          </div>
        </div>
      </div>
    </div>



    <script>
      document.addEventListener('DOMContentLoaded', function () {
        let optionIndex = 1; // Start at 1 for dynamically added options, 0 is already present

        // Get the input field by its ID
        const inputField = document.getElementById('question-label-input-q1');

        // Ensure the input field exists before adding event listener
        if (!inputField) {
          console.error('Input field not found.');
          return;
        }

        // Get the radio legend element
        const radioLegend = document.querySelector('#radio-list fieldset legend');

        if (!radioLegend) {
          console.error('Radio legend not found.');
          return;
        }


        // Add a new radio option in the list preview
        const addRadioOption = (index) => {
          const radioList = document.getElementById('radio-list');
          const newRadioHTML = `
            <div class="govuk-radios__item">
              <input class="govuk-radios__input" id="listPreview-option${index}" name="listPreview" type="radio" value="option${index}">
              <label class="govuk-label govuk-radios__label" for="listPreview-option${index}">Option ${index + 1}</label>
            </div>
          `;
          radioList.insertAdjacentHTML('beforeend', newRadioHTML);
        };

        // Set up MutationObserver to monitor new options being added dynamically
        const observer = new MutationObserver(function(mutations) {
          mutations.forEach(function(mutation) {
            mutation.addedNodes.forEach(function(node) {
              if (node.nodeType === 1 && node.classList.contains('moj-add-another__item')) {
                const input = node.querySelector('input');
                const legend = node.querySelector('legend');

                if (input && legend) {
                  console.log(`New input detected for index: ${optionIndex}`);

                  // Add corresponding radio button in the preview
                  addRadioOption(optionIndex);

                  // Update the legend with the number
                  updateLegend(optionIndex, legend);

                  optionIndex++; // Increment for the next added option
                }
              }
            });
          });
        });

        // Start observing the options container for added fields
        const optionsContainer = document.querySelector('#options-form');
        if (optionsContainer) {
          observer.observe(optionsContainer, { childList: true, subtree: true });
        }

        // Delay to ensure DOM is fully rendered before handling the first input
        setTimeout(() => {
          const firstInput = document.getElementById('option[0][option_label]');
          const firstLegend = document.querySelector('legend');

          if (firstInput && firstLegend) {
            console.log("Handling first input (option[0]) manually after delay");

            // Add an initial radio option for the first field (option[0])
            addRadioOption(0);
          } else {
            console.log("First input or legend not found!");
          }
        }, 100); // Delay by 100ms to ensure DOM readiness

      });
    </script>























    <style>

      .highlight {
        background-color: #ffe5cc;
        border-bottom: 2px solid #ffb266;
      }

      #before-content {
        position: absolute;
        top: 0;
        left: 10 !important;
        right: 0;
        /* Ensure the right side is aligned with the container edge */
        width: 100%;
        padding: 10px !important;

        /* Remove padding to avoid affecting the width */
        box-sizing: border-box;
        /* Ensure content, padding, and borders are within width */
        z-index: 1;
        border-bottom: 1px solid #008938;
        padding-left: 10px;
        /* Add padding-left specifically for content */
      }

      #second-container {
        padding: 0;
        /* Ensure no padding on the container itself */
        box-sizing: border-box;
        /* Ensure container handles padding/border correctly */
      }

      #second-container > * {
        padding-left: 0px;
        z-index: 2;
        /* Ensure content is above the #before-content */
      }
    </style>

    {% endblock %}
  </div>
</div>
